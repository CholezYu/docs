## 浏览器缓存机制

- 缓存可以重用已获取的资源，能够有效地提升网站与应用的性能

- 缓存分为：强制缓存和协商缓存

## 强制缓存

- 强制浏览器使用当前缓存(没有发送请求)

  - 客户端请求的时候，需要携带 Cache-Control 请求头字段，值是 max-age=xxx (s)

  - 服务器响应的时候，也可以携带 Cache-Control 响应头字段，值是 max-age=xxx (s)

  - 当客户端再次发送请求时，判断是否符合强制缓存条件。如果符合，则直接读取缓存，状态码为 200；否则进行协商缓存

## 协商缓存

- 强制缓存失败后，浏览器携带缓存标识向服务器发起请求，服务器根据缓存标识决定是否使用缓存

  - 客户端第一次向服务器发送请求

  - 服务器将 Etag (文件唯一标识) 和 Last-modified (文件最后一次修改时间) 通过响应头方式返回

  - 客户端接收 Etag 和 Last-modified 后保存起来

  - 客户端第二次向服务器发送请求时携带缓存字段，将 If-None-Match (Etag) 和 If-Modified-Since (Last-modified) 通过请求头的方式发送给服务器

  - 服务器检查最新的 Etag 与客户端发送过来的 If-None-Match 是否相等，如果相等，则再判断最新的 Last-modified 与客户端发送过来的 If-Modified-Since 是否相等

  - 如果以上两个值都相等，则响应 304 状态码，要求客户端读取缓存

  - 如果有一个值不相等，则服务器返回最新的数据与最新的 Etag 和 Last-modofied
